require('../common/vendor.js');(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/goods/goods_list/index"],{"0899":function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=i("78a2"),s=i("d5f7"),o=i("26cb"),n=i("7a16"),c=i("79c7"),a=u(i("a29e")),h=i("5f9b");function u(t){return t&&t.__esModule?t:{default:t}}var d=function(){Promise.all([i.e("common/vendor"),i.e("components/home/index")]).then(function(){return resolve(i("d878"))}.bind(null,i)).catch(i.oe)},l=function(){i.e("components/homeList/index").then(function(){return resolve(i("8164"))}.bind(null,i)).catch(i.oe)},p=function(){i.e("components/productWindow/index").then(function(){return resolve(i("82c0"))}.bind(null,i)).catch(i.oe)},f=function(){i.e("components/maramlee-waterfalls-flow/maramlee-waterfalls-flow").then(function(){return resolve(i("ad4f"))}.bind(null,i)).catch(i.oe)},_=function(){Promise.all([i.e("common/vendor"),i.e("components/recommend/index")]).then(function(){return resolve(i("6019"))}.bind(null,i)).catch(i.oe)},g={computed:(0,o.mapGetters)(["uid","isLogin"]),components:{recommend:_,home:d,homeList:l,waterfallsFlow:f,productWindow:p},mixins:[a.default],data:function(){return{id:0,productValue:[],is_vip:0,attr:{cartAttr:!1,productAttr:[],productSelect:{}},attrValue:"",navH:22,sysHeight:0,goodList:!0,currentPage:!1,brandtip:!1,brandArray:[],productList:[],is_switch:!0,where:{sid:0,keyword:"",priceOrder:"",salesOrder:"",news:0,page:1,limit:20,cid:0,brand_id:[],promotions_id:0},price:0,stock:0,nows:!1,loadend:!1,loading:!1,loadTitle:"加载更多",title:"",hostProduct:[],hotPage:1,hotLimit:10,hotScroll:!1,brandList:[],storeInfo:{},promotions_type:0,totalPrice:0,promotionsInfo:{},totalNum:0,imgHost:h.HTTP_REQUEST_URL}},onLoad:function(t){this.where.cid=t.cid||0,this.$set(this.where,"sid",t.sid||0),this.title=t.title||"",this.$set(this.where,"keyword",t.searchValue||""),this.$set(this.where,"productId",t.productId||""),t.promotions_type&&(this.promotions_type=t.promotions_type,this.where.promotions_id=t.promotions_id,t.promotions_type&&(this.is_switch=!1)),this.get_product_list(),this.getBrand()},onShow:function(){t.removeStorageSync("form_type_cart"),!1===this.isLogin?(0,s.toLogin)():this.is_switch||(this.getCartList(),this.getCartNum())},methods:{getCartNum:function(){var t=this;(0,c.getCartCounts)().then((function(e){t.totalNum=e.data.count})).catch((function(e){return t.$util.Tips({title:e})}))},getCartList:function(){var t=this,e=0;(0,c.getCartList)().then((function(i){var r=i.data,s=i.data.valid;s.forEach((function(i){i.promotions.forEach((function(e){t.where.promotions_id==e.id&&(t.promotionsInfo=e)})),i.cart.forEach((function(i){e=t.$util.$h.Add(e,t.$util.$h.Mul(i.truePrice,i.cart_num))}))})),t.totalPrice=t.$util.$h.Sub(e,r.deduction.coupon_price)})).catch((function(e){return t.$util.Tips({title:e})}))},goCart:function(){t.switchTab({url:"/pages/order_addcart/order_addcart"})},goCat:function(e){var i=this,s=i.productValue[this.attrValue];if(i.attr.productAttr.length&&void 0===s)return i.$util.Tips({title:"产品库存不足，请选择其它属性"});if(i.attr.productSelect.cart_num<=0)return i.attr.productSelect.cart_num=1,i.$util.Tips({title:"请先选择属性"});var o={productId:i.id,cartNum:i.attr.productSelect.cart_num,new:0,uniqueId:void 0!==i.attr.productSelect?i.attr.productSelect.unique:""};(0,r.postCartAdd)(o).then((function(r){i.isOpen=!1,i.attr.cartAttr=!1,e?t.navigateTo({url:"/pages/goods/order_confirm/index?new=1&cartId="+r.data.cartId}):i.$util.Tips({title:"添加购物车成功"}),i.getCartNum(),i.getCartList()})).catch((function(t){return i.isOpen=!1,i.$util.Tips({title:t})}))},joinCart:function(e){!1===this.isLogin?(0,s.toLogin)():(t.showLoading({title:"加载中"}),this.getAttrs(e.id),this.$set(this,"id",e.id),this.$set(this.attr,"cartAttr",!0))},getAttrs:function(e){var i=this;(0,r.getAttr)(e,0).then((function(e){t.hideLoading(),i.$set(i.attr,"productAttr",e.data.productAttr),i.$set(i,"productValue",e.data.productValue),i.$set(i,"is_vip",e.data.storeInfo.is_vip),i.$set(i,"storeInfo",e.data.storeInfo),i.DefaultSelect()}))},DefaultSelect:function(){var t=this.attr.productAttr,e=[];for(var i in this.productValue)if(this.productValue[i].stock>0){e=this.attr.productAttr.length?i.split(","):[];break}for(var r=0;r<t.length;r++)this.$set(t[r],"index",e[r]);var s=this.productValue[e.join(",")];s&&t.length?(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",s.image),this.$set(this.attr.productSelect,"price",s.price),this.$set(this.attr.productSelect,"stock",s.stock),this.$set(this.attr.productSelect,"unique",s.unique),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"attrValue",e.join(",")),this.$set(this.attr.productSelect,"vip_price",s.vip_price)):!s&&t.length?(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this.attr.productSelect,"vip_price",this.storeInfo.vip_price),this.$set(this,"attrValue","")):s||t.length||(this.$set(this.attr.productSelect,"store_name",this.storeInfo.store_name),this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",this.storeInfo.stock),this.$set(this.attr.productSelect,"unique",this.storeInfo.unique||""),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this.attr.productSelect,"vip_price",this.storeInfo.vip_price),this.$set(this,"attrValue",""))},iptCartNum:function(t){this.$set(this.attr.productSelect,"cart_num",t)},attrVal:function(t){this.$set(this.attr.productAttr[t.indexw],"index",this.attr.productAttr[t.indexw].attr_values[t.indexn])},onMyEvent:function(){this.$set(this.attr,"cartAttr",!1)},ChangeAttr:function(t){var e=this.productValue[t];e&&e.stock>0?(this.$set(this.attr.productSelect,"image",e.image),this.$set(this.attr.productSelect,"price",e.price),this.$set(this.attr.productSelect,"stock",e.stock),this.$set(this.attr.productSelect,"unique",e.unique),this.$set(this.attr.productSelect,"vip_price",e.vip_price),this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"attrValue",t)):e&&0==e.stock?(this.$set(this.attr.productSelect,"image",e.image),this.$set(this.attr.productSelect,"price",e.price),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"vip_price",e.vip_price),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this,"attrValue","")):(this.$set(this.attr.productSelect,"image",this.storeInfo.image),this.$set(this.attr.productSelect,"price",this.storeInfo.price),this.$set(this.attr.productSelect,"stock",0),this.$set(this.attr.productSelect,"unique",""),this.$set(this.attr.productSelect,"vip_price",this.storeInfo.vip_price),this.$set(this.attr.productSelect,"cart_num",0),this.$set(this,"attrValue",""))},ChangeCartNum:function(t){var e=this.productValue[this.attrValue];if(void 0!==e||this.attr.productAttr.length||(e=this.attr.productSelect),void 0!==e){var i=e.stock||0,r=this.attr.productSelect;t?(r.cart_num++,r.cart_num>i&&(this.$set(this.attr.productSelect,"cart_num",i||1),this.$set(this,"cart_num",i||1))):(r.cart_num--,r.cart_num<1&&(this.$set(this.attr.productSelect,"cart_num",1),this.$set(this,"cart_num",1)))}},moreNav:function(){this.currentPage=!this.currentPage},getBrand:function(){var t=this;(0,r.brand)(this.where).then((function(e){t.brandList=e.data})).catch((function(e){return t.$util.Tips({title:e.msg})}))},set_brand:function(){this.brandtip=!0,this.currentPage=!1},closeBrand:function(){this.brandtip=!1},seletBrand:function(t){-1==this.brandArray.indexOf(t)?this.brandArray.push(t):this.brandArray.splice(this.brandArray.indexOf(t),1)},brandReset:function(){this.brandArray=[],this.brandOk()},brandOk:function(){this.brandtip=!1,this.loadend=!1,this.$set(this.where,"page",1),this.get_product_list(!0)},godDetail:function(e){this.currentPage=!1,this.promotions_type?t.navigateTo({url:"/pages/goods_details/index?id=".concat(e.id)}):(0,n.goShopDetail)(e,this.uid).then((function(i){t.navigateTo({url:"/pages/goods_details/index?id=".concat(e.id)})}))},Changswitch:function(){var t=this;this.currentPage=!1,t.is_switch=!t.is_switch},searchSubmit:function(t){var e=this;this.currentPage=!1,e.$set(e.where,"keyword",t.detail.value),e.loadend=!1,e.$set(e.where,"page",1),this.get_product_list(!0)},get_host_product:function(){var t=this;t.hotScroll||(0,r.getProductHot)(t.hotPage,t.hotLimit).then((function(e){t.hotPage++,t.hotScroll=e.data.length<t.hotLimit,t.hostProduct=t.hostProduct.concat(e.data)}))},set_where:function(e){switch(this.currentPage=!1,e){case 1:return t.navigateBack({delta:1});case 2:0==this.price?this.price=1:1==this.price?this.price=2:2==this.price&&(this.price=0),this.stock=0;break;case 3:0==this.stock?this.stock=1:1==this.stock?this.stock=2:2==this.stock&&(this.stock=0),this.price=0;break;case 4:this.nows=!this.nows;break}this.loadend=!1,this.$set(this.where,"page",1),this.get_product_list(!0)},setWhere:function(){0==this.price?this.where.priceOrder="":1==this.price?this.where.priceOrder="asc":2==this.price&&(this.where.priceOrder="desc"),0==this.stock?this.where.salesOrder="":1==this.stock?this.where.salesOrder="asc":2==this.stock&&(this.where.salesOrder="desc"),this.where.news=this.nows?1:0},get_product_list:function(t){var e=this,i=this;i.setWhere(),i.loadend||i.loading||(!0===t&&(this.is_switch&&i.$refs.waterfallsFlow.refresh(),i.$set(i,"productList",[])),i.loading=!0,i.loadTitle="",i.$set(i.where,"brand_id",i.brandArray.join(",")),(0,r.getProductslist)(i.where).then((function(t){var r=t.data,s=i.$util.SplitArray(r,i.productList),o=r.length<i.where.limit;i.loadend=o,i.loading=!1,i.loadTitle=o?"没有更多内容啦~":"加载更多",i.$set(i,"productList",s),i.$set(i.where,"page",i.where.page+1),i.productList.length||e.get_host_product()})).catch((function(t){i.loading=!1,i.loadTitle="加载更多"})))}},onPullDownRefresh:function(){},onPageScroll:function(t){this.currentPage=!1},onReachBottom:function(){this.productList.length>0?this.get_product_list():this.get_host_product()}};e.default=g}).call(this,i("543d")["default"])},"129b":function(t,e,i){"use strict";(function(t){i("8824");r(i("66fd"));var e=r(i("6941"));function r(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=i,t(e.default)}).call(this,i("543d")["createPage"])},6941:function(t,e,i){"use strict";i.r(e);var r=i("a254"),s=i("d9a0");for(var o in s)"default"!==o&&function(t){i.d(e,t,(function(){return s[t]}))}(o);i("e522e");var n,c=i("f0c5"),a=Object(c["a"])(s["default"],r["b"],r["c"],!1,null,"34711ba6",null,!1,r["a"],n);e["default"]=a.exports},9761:function(t,e,i){},a254:function(t,e,i){"use strict";var r;i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return r}));var s=function(){var t=this,e=t.$createElement,i=(t._self._c,0==t.is_switch&&t.promotions_type&&4!=this.promotions_type&&t.promotionsInfo.differ_threshold>0&&(t.promotionsInfo.differ_price||t.promotionsInfo.differ_discount)&&!t.promotionsInfo.differ_price?parseFloat(t.promotionsInfo.differ_discount):null),r=0!=t.is_switch?t.__map(t.productList,(function(e,i){var r=t.__get_orig(e),s=e.price.toString().split("."),o=e.price.toString().split("."),n=o.length>1?e.price.toString().split("."):null;return{$orig:r,g0:s,g1:o,g2:n}})):null,s=t.__map(t.brandList,(function(e,i){var r=t.__get_orig(e),s=t.brandArray.indexOf(e.id);return{$orig:r,g3:s}}));t.$mp.data=Object.assign({},{$root:{m0:i,l0:r,l1:s}})},o=[]},d9a0:function(t,e,i){"use strict";i.r(e);var r=i("0899"),s=i.n(r);for(var o in r)"default"!==o&&function(t){i.d(e,t,(function(){return r[t]}))}(o);e["default"]=s.a},e522e:function(t,e,i){"use strict";var r=i("9761"),s=i.n(r);s.a}},[["129b","common/runtime","common/vendor"]]]);