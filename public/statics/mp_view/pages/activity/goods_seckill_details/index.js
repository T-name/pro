(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/activity/goods_seckill_details/index"],{"0c50":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,r=o("26cb"),n=o("3995"),s=o("78a2"),a=o("ace8"),u=o("d5f7"),c=o("2f2d"),l=o("99c8"),h=o("5f9b"),d=o("9357"),p=f(o("a29e"));function f(t){return t&&t.__esModule?t:{default:t}}function m(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var g=getApp(),b=t.getSystemInfoSync().statusBarHeight+"px",S=function(){Promise.all([o.e("common/vendor"),o.e("components/zb-code/zb-code")]).then(function(){return resolve(o("0657"))}.bind(null,o)).catch(o.oe)},v=function(){o.e("components/productConSwiper/index").then(function(){return resolve(o("4550"))}.bind(null,o)).catch(o.oe)},$=function(){o.e("components/productWindow/index").then(function(){return resolve(o("82c0"))}.bind(null,o)).catch(o.oe)},I=function(){Promise.all([o.e("common/vendor"),o.e("components/userEvaluation/index")]).then(function(){return resolve(o("56cf"))}.bind(null,o)).catch(o.oe)},_=function(){o.e("components/kefuIcon/index").then(function(){return resolve(o("2004"))}.bind(null,o)).catch(o.oe)},C=function(){o.e("components/cusPreviewImg/index").then(function(){return resolve(o("17d4"))}.bind(null,o)).catch(o.oe)},w=function(){o.e("components/homeList/index").then(function(){return resolve(o("8164"))}.bind(null,o)).catch(o.oe)},k=function(){Promise.all([o.e("common/vendor"),o.e("components/jyf-parser/jyf-parser")]).then(function(){return resolve(o("217b"))}.bind(null,o)).catch(o.oe)},A=function(){o.e("components/countDown/index").then(function(){return resolve(o("00a7"))}.bind(null,o)).catch(o.oe)},P=(i={computed:(0,r.mapGetters)(["isLogin"]),mixins:[p.default],data:function(){return{showSkeleton:!0,isNodes:0,dataShow:0,id:0,time:0,countDownHour:"00",countDownMinute:"00",countDownSecond:"00",storeInfo:{brand_name:""},imgUrls:[],parameter:{navbar:"1",return:"1",title:"抢购详情页",color:!1},attribute:{cartAttr:!1,productAttr:[],productSelect:{}},productValue:[],isOpen:!1,attr:"请选择",attrValue:"",status:1,isAuto:!1,isShowAuth:!1,iShidden:!1,limitNum:1,iSplus:!1,replyCount:0,reply:[],replyChance:0,navH:"",navList:["商品","评价","详情"],opacity:0,scrollY:0,topArr:[],toView:"",height:0,heightArr:[],lock:!1,scrollTop:0,tagStyle:{img:"width:100%;display:block;",table:"width:100%",video:"width:100%"},datatime:0,navActive:0,meunHeight:0,backH:"",posters:!1,weixinStatus:!1,posterImageStatus:!1,canvasStatus:!1,storeImage:"",PromotionCode:"",posterImage:"",posterbackgd:"/static/images/posterbackgd.png",actionSheetHidden:!1,cart_num:"",homeTop:20,returnShow:!0,H5ShareBox:!1,routineContact:0,siteName:"",themeColor:"",fontColor:"",skuArr:[],codeShow:!1,cid:"1",codeVal:"",size:200,unit:"upx",background:"#FFF",foreground:"#000",pdground:"#000",codeIcon:"",iconsize:40,lv:3,onval:!0,loadMake:!0,base64Show:0,shareQrcode:0,followCode:"",selectSku:{},currentPage:!1,sysHeight:b,imgHost:h.HTTP_REQUEST_URL}},components:{zbCode:S,productConSwiper:v,productWindow:$,userEvaluation:I,kefuIcon:_,cusPreviewImg:C,"jyf-parser":k,countDown:A,homeList:w}},m(i,"computed",(0,r.mapGetters)(["isLogin"])),m(i,"watch",{isLogin:{handler:function(t,e){t&&this.getSeckillDetail()},deep:!0}}),m(i,"onLoad",(function(e){var o=this,i=this,r=getCurrentPages();i.returnShow=1!==r.length,t.getSystemInfo({success:function(t){i.height=t.windowHeight,t.statusBarHeight}}),this.isLogin&&(0,c.silenceBindingSpread)(),this.navH=g.globalData.navHeight;var n=t.getMenuButtonBoundingClientRect();if(this.meunHeight=n.height,this.backH=i.navH/2+this.meunHeight/2,e.scene){var s=this.$util.getUrlParams(decodeURIComponent(e.scene));if(!s.id)return this.showSkeleton=!1,this.$util.Tips({title:"缺少参数无法查看商品"},{tab:3,url:1});this.id=s.id,s.pid&&(g.globalData.spid=s.pid)}e.id&&(this.id=e.id,e.pid&&(g.globalData.spid=e.pid)),this.isLogin&&e.id?(i.downloadFilePromotionCode(),this.getSeckillDetail()):(0,u.toLogin)(),this.$nextTick((function(){var e=t.getMenuButtonBoundingClientRect(),i=t.createSelectorQuery().in(o);i.select("#home").boundingClientRect((function(t){o.homeTop=2*e.top+e.height-t.height})).exec()})),this.colorData();var a=[{themeColor:"#1DB0FC",fontColor:"#FD502F"},{themeColor:"#42CA4D",fontColor:"#FF7600"},{themeColor:"#e93323",fontColor:"#e93323"},{themeColor:"#FF448F",fontColor:"#FF448F"},{themeColor:"#FE5C2D",fontColor:"#FE5C2D"}];setTimeout((function(){switch(o.colorNum){case 1:o.themeColor=a[0].themeColor,o.fontColor=a[0].fontColor;break;case 2:o.themeColor=a[1].themeColor,o.fontColor=a[1].fontColor;break;case 3:o.themeColor=a[2].themeColor,o.fontColor=a[2].fontColor;break;case 4:o.themeColor=a[3].themeColor,o.fontColor=a[3].fontColor;break;case 5:o.themeColor=a[4].themeColor,o.fontColor=a[4].fontColor;break;default:o.themeColor=a[2].themeColor,o.fontColor=a[2].fontColor;break}}),1)})),m(i,"onReady",(function(){this.isNodes++})),m(i,"onShow",(function(){t.removeStorageSync("form_type_cart")})),m(i,"methods",{moreNav:function(){this.currentPage=!this.currentPage},showImg:function(t){this.$refs.cusPreviewImg.open(this.selectSku.suk)},changeSwitch:function(t){var e=this,o=this.skuArr[t];this.$set(this,"selectSku",o);var i=o.suk.split(",");i.forEach((function(t,o){e.$set(e.attribute.productAttr[o],"index",i[o])})),o&&(this.$set(this.attribute.productSelect,"image",o.image),this.$set(this.attribute.productSelect,"price",o.price),this.$set(this.attribute.productSelect,"stock",o.stock),this.$set(this.attribute.productSelect,"unique",o.unique),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this.attribute.productSelect,"quota",o.quota),this.$set(this.attribute.productSelect,"quota_show",o.quota_show),this.$set(this,"attrValue",o.suk),this.attrTxt="已选择")},qrR:function(t){},getpreviewImage:function(){if(this.posterImage){var e=[];e.push(this.posterImage),t.previewImage({urls:e,current:this.posterImage})}else his.$util.Tips({title:"您的海报尚未生成"})},iptCartNum:function(t){this.$set(this.attribute.productSelect,"cart_num",t),this.$set(this,"cart_num",t)},returns:function(){return t.navigateBack({delta:1})},onLoadFun:function(t){this.isAuto&&(this.isAuto=!1,this.isShowAuth=!1,this.getSeckillDetail())},getSeckillDetail:function(){var e=this,o=this;(0,n.getSeckillDetail)(o.id).then((function(i){e.dataShow=1;var r=i.data.storeInfo.title;for(var n in e.storeInfo=i.data.storeInfo,e.datatime=Number(i.data.storeInfo.last_time),e.status=i.data.storeInfo.status,e.imgUrls=i.data.storeInfo.images,e.storeInfo.description=e.storeInfo.description.replace(/<img/gi,'<img style="max-width:100%;height:auto;float:left;display:block" '),e.attribute.productAttr=i.data.productAttr,e.productValue=i.data.productValue,i.data.productValue){var s=i.data.productValue[n];o.skuArr.push(s)}o.selectSku=o.skuArr[0],e.attribute.productSelect.num=i.data.storeInfo.num,e.attribute.productSelect.once_num=i.data.storeInfo.once_num,e.replyCount=i.data.replyCount,e.reply=i.data.reply?[i.data.reply]:[],e.replyChance=i.data.replyChance,e.shareQrcode=i.data.share_qrcode,o.routineContact=Number(i.data.routine_contact_type),t.setNavigationBarTitle({title:r.substring(0,7)+"..."}),o.siteName=i.data.site_name;var a=["商品","详情"];i.data.replyCount&&a.splice(1,0,"评价"),o.$set(o,"navList",a),o.downloadFilestoreImage(),o.DefaultSelect(),setTimeout((function(){o.infoScroll()}),500),g.globalData.openPages="/pages/activity/goods_seckill_details/index?id="+o.id+"&time="+o.time+"&status="+o.status+"&pid="+o.storeInfo.uid,setTimeout((function(){o.showSkeleton=!1}),300)})).catch((function(t){o.$util.Tips({title:t},{tab:3})}))},setShare:function(){this.$wechat.isWeixin()&&this.$wechat.wechatEvevt(["updateAppMessageShareData","updateTimelineShareData","onMenuShareAppMessage","onMenuShareTimeline"],{desc:this.storeInfo.info,title:this.storeInfo.title,link:location.href,imgUrl:this.storeInfo.image}).then((function(t){})).catch((function(t){}))},DefaultSelect:function(){var t=this,e=t.attribute.productAttr,o=[];for(var i in this.productValue)if(this.productValue[i].quota>0){o=this.attribute.productAttr.length?i.split(","):[];break}for(var r=0;r<e.length;r++)this.$set(e[r],"index",o[r]);var n=this.productValue[o.join(",")];n&&e.length?(t.$set(t.attribute.productSelect,"store_name",t.storeInfo.title),t.$set(t.attribute.productSelect,"image",n.image),t.$set(t.attribute.productSelect,"price",n.price),t.$set(t.attribute.productSelect,"stock",n.stock),t.$set(t.attribute.productSelect,"unique",n.unique),t.$set(t.attribute.productSelect,"quota",n.quota),t.$set(t.attribute.productSelect,"quota_show",n.quota_show),t.$set(t.attribute.productSelect,"product_stock",n.product_stock),t.$set(t.attribute.productSelect,"cart_num",1),t.$set(t,"attrValue",o.join(",")),t.attrValue=o.join(",")):!n&&e.length?(t.$set(t.attribute.productSelect,"store_name",t.storeInfo.title),t.$set(t.attribute.productSelect,"image",t.storeInfo.image),t.$set(t.attribute.productSelect,"price",t.storeInfo.price),t.$set(t.attribute.productSelect,"quota",0),t.$set(t.attribute.productSelect,"quota_show",0),t.$set(t.attribute.productSelect,"product_stock",0),t.$set(t.attribute.productSelect,"stock",0),t.$set(t.attribute.productSelect,"unique",""),t.$set(t.attribute.productSelect,"cart_num",0),t.$set(t,"attrValue",""),t.$set(t,"attrTxt","请选择")):n||e.length||(t.$set(t.attribute.productSelect,"store_name",t.storeInfo.title),t.$set(t.attribute.productSelect,"image",t.storeInfo.image),t.$set(t.attribute.productSelect,"price",t.storeInfo.price),t.$set(t.attribute.productSelect,"stock",t.storeInfo.stock),t.$set(t.attribute.productSelect,"quota",t.storeInfo.quota),t.$set(t.attribute.productSelect,"product_stock",t.storeInfo.product_stock),t.$set(t.attribute.productSelect,"unique",t.storeInfo.unique||""),t.$set(t.attribute.productSelect,"cart_num",1),t.$set(t.attribute.productSelect,"quota",n.quota),t.$set(t.attribute.productSelect,"product_stock",n.product_stock),t.$set(t,"attrValue",""),t.$set(t,"attrTxt","请选择"))},selecAttr:function(){this.currentPage=!1,this.attribute.cartAttr=!0},onMyEvent:function(){this.$set(this.attribute,"cartAttr",!1),this.$set(this,"isOpen",!1)},ChangeCartNum:function(t){var e=this.productValue[this.attrValue];if(this.cart_num&&(e.cart_num=this.cart_num,this.attribute.productSelect.cart_num=this.cart_num),void 0!==e||this.attribute.productAttr.length||(e=this.attribute.productSelect),void 0!==e){e.stock,e.quota_show;var o=e.quota||0,i=e.product_stock||0,r=this.attribute.productSelect,n=this.storeInfo.num||0,s=this.storeInfo.once_num||0;if(void 0==e.cart_num&&(e.cart_num=1),t){r.cart_num++;var a=[];a.push(n),a.push(s),a.push(o),a.push(i);var u=Math.min.apply(null,a);r.cart_num>=u&&(this.$set(this.attribute.productSelect,"cart_num",u||1),this.$set(this,"cart_num",u||1)),this.$set(this,"cart_num",r.cart_num),this.$set(this.attribute.productSelect,"cart_num",r.cart_num)}else r.cart_num--,r.cart_num<1&&(this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this,"cart_num",1)),this.$set(this,"cart_num",r.cart_num),this.$set(this.attribute.productSelect,"cart_num",r.cart_num)}},attrVal:function(t){this.attribute.productAttr[t.indexw].index=this.attribute.productAttr[t.indexw].attr_values[t.indexn]},ChangeAttr:function(t){this.$set(this,"cart_num",1);var e=this.productValue[t];this.$set(this,"selectSku",e),e?(this.$set(this.attribute.productSelect,"image",e.image),this.$set(this.attribute.productSelect,"price",e.price),this.$set(this.attribute.productSelect,"stock",e.stock),this.$set(this.attribute.productSelect,"unique",e.unique),this.$set(this.attribute.productSelect,"cart_num",1),this.$set(this.attribute.productSelect,"quota",e.quota),this.$set(this.attribute.productSelect,"quota_show",e.quota_show),this.$set(this,"attrValue",t),this.attrTxt="已选择"):(this.$set(this.attribute.productSelect,"image",this.storeInfo.image),this.$set(this.attribute.productSelect,"price",this.storeInfo.price),this.$set(this.attribute.productSelect,"stock",0),this.$set(this.attribute.productSelect,"unique",""),this.$set(this.attribute.productSelect,"cart_num",0),this.$set(this.attribute.productSelect,"quota",0),this.$set(this.attribute.productSelect,"quota_show",0),this.$set(this,"attrValue",""),this.attrTxt="已选择")},scroll:function(t){var e=this,o=t.detail.scrollTop,i=o/200;if(i=i>1?1:i,e.opacity=i,e.scrollY=o,e.currentPage=!1,e.lock)e.lock=!1;else for(var r=0;r<e.topArr.length;r++)if(o<e.topArr[r]-g.globalData.navHeight/2+e.heightArr[r]){e.navActive=r;break}},tap:function(t,e){var o=t.id,i=(e=e,this);this.replyCount||"past1"!=o||(o="past2"),this.toView=o,this.navActive=e,this.lock=!0,this.scrollTop=e>0?i.topArr[e]-g.globalData.navHeight/2:i.topArr[e]},infoScroll:function(){for(var t=this,e=[],o=[],i=0;i<t.navList.length;i++){var r=wx.createSelectorQuery().in(this),n="#past"+i;this.replyCount||1!=i||(n="#past2"),r.select(n).boundingClientRect(),r.exec((function(i){var r=i[0].top,n=i[0].height;e.push(r),o.push(n),t.topArr=e,t.heightArr=o}))}},setCollect:(0,d.Debounce)((function(){var t=this;this.storeInfo.userCollect?(0,s.collectDel)(this.storeInfo.product_id).then((function(e){t.storeInfo.userCollect=!t.storeInfo.userCollect})):(0,s.collectAdd)(this.storeInfo.product_id).then((function(e){t.storeInfo.userCollect=!t.storeInfo.userCollect}))})),openAlone:(0,d.Debounce)((function(){t.navigateTo({url:"/pages/goods_details/index?id=".concat(this.storeInfo.product_id)})})),goCat:function(){var e=this,o=this;o.currentPage=!1;var i=this.productValue[this.attrValue];return this.isOpen?this.attribute.cartAttr=!0:this.attribute.cartAttr=!this.attribute.cartAttr,!0===this.attribute.cartAttr&&0==this.isOpen?this.isOpen=!0:this.attribute.productAttr.length&&void 0===i&&1==this.isOpen?g.$util.Tips({title:"请选择属性"}):void(0,s.postCartAdd)({productId:o.storeInfo.product_id,secKillId:o.id,bargainId:0,combinationId:0,cartNum:o.cart_num,uniqueId:void 0!==i?i.unique:"",new:1}).then((function(o){e.isOpen=!1,t.navigateTo({url:"/pages/goods/order_confirm/index?new=1&cartId="+o.data.cartId})})).catch((function(t){return e.$util.Tips({title:t})}))},listenerActionSheet:function(){this.currentPage=!1,!1===this.isLogin?(0,u.toLogin)():(this.posters=!0,this.goPoster())},listenerActionClose:function(){this.posters=!1},posterImageClose:function(){this.posterImageStatus=!1,this.posters=!1},setDomain:function(t){return t=t?t.toString():"",t.indexOf("https://")>-1?t:t.replace("http://","https://")},downloadFilestoreImage:function(){var e=this;t.downloadFile({url:e.setDomain(e.storeInfo.image),success:function(t){e.storeImage=t.tempFilePath,e.base64Show=1},fail:function(){return e.$util.Tips({title:""})}})},downloadFilePromotionCode:function(e){var o=this;(0,n.seckillCode)(o.id,{stop_time:o.datatime}).then((function(i){t.downloadFile({url:o.setDomain(i.data.code),success:function(t){o.$set(o,"isDown",!1),"function"==typeof e?e&&e(t.tempFilePath):o.$set(o,"PromotionCode",t.tempFilePath)},fail:function(){o.$set(o,"isDown",!1),o.$set(o,"PromotionCode","")}})})).catch((function(t){o.$set(o,"isDown",!1),o.$set(o,"PromotionCode","")}))},getImageBase64:function(t){var e=this;(0,a.imageBase64)(e.storeImage,e.followCode).then((function(o){e.storeImage=o.data.image,t&&(e.PromotionCode=o.data.code),e.base64Show=1})).catch((function(){}))},goPoster:function(){var e=this;e.$set(e,"canvasStatus",!0);var o=[e.posterbackgd,e.storeImage,e.PromotionCode];return""!=e.PromotionCode||e.isDown?e.isDown?e.$util.Tips({title:"正在下载海报,请稍后再试！"},(function(){e.posters=!1})):void t.getImageInfo({src:e.PromotionCode,fail:function(t){return e.$util.Tips({title:"小程序二维码需要发布正式版后才能获取到"})},success:function(){""==o[2]?e.downloadFilePromotionCode((function(t){if(o[2]=t,""==o[2])return e.$util.Tips({title:"海报二维码生成失败！"});e.$nextTick((function(){e.$util.PosterCanvas(e.fontColor,e.themeColor,e.siteName,o,e.storeInfo.title,e.storeInfo.price,e.storeInfo.ot_price,(function(t){e.$set(e,"posterImage",t),e.$set(e,"posterImageStatus",!0),e.$set(e,"canvasStatus",!1),e.$set(e,"actionSheetHidden",!e.actionSheetHidden)}))}))})):e.$nextTick((function(){e.$util.PosterCanvas(e.fontColor,e.themeColor,e.siteName,o,e.storeInfo.title,e.storeInfo.price,e.storeInfo.ot_price,(function(t){e.$set(e,"posterImage",t),e.$set(e,"posterImageStatus",!0),e.$set(e,"canvasStatus",!1),e.$set(e,"actionSheetHidden",!e.actionSheetHidden)}))}))}}):e.$util.Tips({title:"小程序二维码需要发布正式版后才能获取到"},(function(){e.posters=!1}))},savePosterPath:function(){var e=this;t.getSetting({success:function(o){o.authSetting["scope.writePhotosAlbum"]?t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}}):t.authorize({scope:"scope.writePhotosAlbum",success:function(){t.saveImageToPhotosAlbum({filePath:e.posterImage,success:function(t){e.posterImageClose(),e.$util.Tips({title:"保存成功",icon:"success"})},fail:function(t){e.$util.Tips({title:"保存失败"})}})}})}})},setShareInfoStatus:function(){var t=this,e=this.storeInfo,o=location.href;this.$wechat.isWeixin()&&(this.posters=!0,(0,l.getUserInfo)().then((function(i){o=-1===o.indexOf("?")?o+"?spread="+i.data.uid:o+"&spread="+i.data.uid;var r={desc:e.store_info,title:e.store_name,link:o,imgUrl:e.image};t.$wechat.wechatEvevt(["updateAppMessageShareData","updateTimelineShareData"],r)})))}}),m(i,"onShareAppMessage",(function(){return{title:this.storeInfo.title,path:g.globalData.openPages,imageUrl:this.storeInfo.image}})),m(i,"onShareTimeline",(function(){var t=this;return{title:t.storeInfo.title,imageUrl:t.storeInfo.image,path:g.globalData.openPages}})),i);e.default=P}).call(this,o("543d")["default"])},3869:function(t,e,o){"use strict";o.r(e);var i=o("effb"),r=o("5602");for(var n in r)"default"!==n&&function(t){o.d(e,t,(function(){return r[t]}))}(n);o("3ffc");var s,a=o("f0c5"),u=Object(a["a"])(r["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],s);e["default"]=u.exports},"3ffc":function(t,e,o){"use strict";var i=o("c9da"),r=o.n(i);r.a},5602:function(t,e,o){"use strict";o.r(e);var i=o("0c50"),r=o.n(i);for(var n in i)"default"!==n&&function(t){o.d(e,t,(function(){return i[t]}))}(n);e["default"]=r.a},a634:function(t,e,o){"use strict";(function(t){o("8824");i(o("66fd"));var e=i(o("3869"));function i(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=o,t(e.default)}).call(this,o("543d")["createPage"])},c9da:function(t,e,o){},effb:function(t,e,o){"use strict";o.d(e,"b",(function(){return r})),o.d(e,"c",(function(){return n})),o.d(e,"a",(function(){return i}));var i={jyfParser:function(){return Promise.all([o.e("common/vendor"),o.e("components/jyf-parser/jyf-parser")]).then(o.bind(null,"217b"))}},r=function(){var t=this,e=t.$createElement,o=(t._self._c,t.storeInfo.brand_name&&t.storeInfo.brand_name.trim()),i=t.attribute.productAttr.length&&t.skuArr.length>1?t.skuArr.slice(0,4):null;t._isMounted||(t.e0=function(e){t.H5ShareBox=!1}),t.$mp.data=Object.assign({},{$root:{g0:o,l0:i}})},n=[]}},[["a634","common/runtime","common/vendor"]]]);